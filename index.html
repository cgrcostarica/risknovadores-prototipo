
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratorio de Riesgos - CGR</title>
    <style>
        :root {
            --primary-color: #394A9A; /* Pantone Reflex Blue U RGB */
            --secondary-color: #25336C; /* Pantone Reflex Blue C RGB */
            --accent-color: #EA7305; /* Pantone 152 C RGB - Color secundario CGR */
            --success-color: #28a9e0; /* Pantone 306 U - Paleta complementaria */
            --warning-color: #f8ae40; /* Pantone 116 U - Paleta complementaria */
            --danger-color: #ef4444;
            --light-gray: #f8fafc;
            --medium-gray: #64748b;
            --dark-gray: #1e293b;
            --cgr-gray: #dbdbdb; /* Pantone Cool Gray 1U - Paleta complementaria */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Helvetica', sans-serif; /* Tipograf√≠a complementaria CGR */
            line-height: 1.6;
            color: var(--dark-gray);
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-family: 'Century Gothic', 'Arial', sans-serif; /* Tipograf√≠a corporativa CGR */
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .header p {
            font-family: 'Century Gothic', 'Arial', sans-serif;
            font-size: 1.1rem;
            color: var(--medium-gray);
        }

        .main-nav {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }

        .nav-button {
            background: white;
            border: none;
            padding: 1.5rem 2rem;
            border-radius: 12px;
            font-family: 'Century Gothic', 'Arial', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-color);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            min-width: 200px;
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .nav-button.active {
            background: var(--primary-color);
            color: white;
        }

        .module {
            display: none;
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            animation: fadeIn 0.5s ease;
        }

        .module.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .module h2 {
            color: var(--primary-color);
            font-family: 'Century Gothic', 'Arial', sans-serif;
            font-size: 2rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .module-icon {
            font-size: 2rem;
        }

        /* M√≥dulo 1 - Gu√≠a Interactiva */
        .glossary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .concept-card {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .concept-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.1);
        }

        .concept-card h3 {
            color: var(--primary-color);
            font-family: 'Century Gothic', 'Arial', sans-serif;
            margin-bottom: 0.5rem;
        }

        .concept-detail {
            display: none;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
            color: var(--medium-gray);
        }

        .concept-detail.active {
            display: block;
        }

        /* M√≥dulo 2 - Mapa de Calor */
        .heat-map-container {
            display: grid;
            gap: 2rem;
            margin-top: 2rem;
        }

        .controls-panel {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        .control-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-family: 'Century Gothic', 'Arial', sans-serif;
            font-weight: 600;
            color: var(--dark-gray);
        }

        .control-group select, .control-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .heat-map {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .risk-item {
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .risk-item.alto {
            border-left-color: var(--accent-color); /* Color secundario CGR para alto riesgo */
            background: #fef2f2;
        }

        .risk-item.medio {
            border-left-color: var(--warning-color);
            background: #fffbeb;
        }

        .risk-item.bajo {
            border-left-color: var(--success-color);
            background: #f0fdf4;
        }

        .risk-level {
            font-weight: 700;
            font-size: 0.875rem;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .risk-level.alto { color: var(--accent-color); }
        .risk-level.medio { color: var(--warning-color); }
        .risk-level.bajo { color: var(--success-color); }

        /* M√≥dulo 3 - Constructor */
        .constructor-form {
            display: grid;
            gap: 2rem;
            margin-top: 2rem;
        }

        .form-group {
            display: grid;
            gap: 0.5rem;
        }

        .form-group label {
            font-family: 'Century Gothic', 'Arial', sans-serif;
            font-weight: 600;
            color: var(--dark-gray);
        }

        .form-group input, .form-group textarea, .form-group select {
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .generate-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .generate-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-1px);
        }

        .generated-content {
            display: none;
            margin-top: 2rem;
            padding: 2rem;
            background: var(--light-gray);
            border-radius: 12px;
            border: 2px dashed var(--primary-color);
        }

        .generated-content.active {
            display: block;
        }

        .ai-suggestion {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .ai-suggestion h4 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .download-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f8fafc;
            border-radius: 8px;
            text-align: center;
        }

        .download-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-family: 'Century Gothic', 'Arial', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin: 0 0.5rem;
        }

        .intro-section {
            text-align: center;
            padding: 3rem;
        }

        .intro-section h2 {
            color: var(--primary-color);
            font-family: 'Century Gothic', 'Arial', sans-serif;
            margin-bottom: 1rem;
        }

        .intro-section p {
            color: var(--medium-gray);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto 2rem;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .feature-card {
            text-align: center;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        /* Estilos adicionales para cumplir con el libro de marca CGR */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Century Gothic', 'Arial', sans-serif;
        }
        
        /* Logo CGR en footer */
        .footer-logo {
            margin-top: 2rem;
            text-align: center;
            padding: 2rem;
            border-top: 2px solid var(--cgr-gray);
            background: rgba(255,255,255,0.05);
        }
        
        .footer-logo p {
            font-family: 'Century Gothic', 'Arial', sans-serif;
            color: white;
            font-size: 0.9rem;
            margin-top: 1rem;
        }
        
        /* Aplicar paleta de colores CGR */
        .ai-suggestion h4 {
            color: var(--primary-color);
            font-family: 'Century Gothic', 'Arial', sans-serif;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .main-nav {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-button {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div style="display: flex; align-items: center; justify-content: center; gap: 2rem; margin-bottom: 1rem;">
                <!-- Logo CGR oficial -->
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQwIiBoZWlnaHQ9IjI0MCIgdmlld0JveD0iMCAwIDI0MCAyNDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyNDAiIGhlaWdodD0iMjQwIiBmaWxsPSJ3aGl0ZSIvPgo8IS0tIExvZ28gQ0dSIG9maWNpYWwgLS0+CjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEyMCwxMjApIj4KICA8IS0tIEVzdGlsaXphY2nDs24gZGVsIG9qbyBkZSBsYSBDR1IgLS0+CiAgPHBhdGggZD0iTTAgMCBtIC0xMDAsLTEwIGwgNzAsLTEwIGwgNjAsMCBsIDcwLDEwIGwgNzAsNDAgbCAtNzAsNTAgbCAtNjAsMTAgbCAtNjAsMCBsIC03MCwtMTAgeiIgZmlsbD0iIzM5NEE5QSIvPgogIDwhLS0gSXJpcyBjb24gN24gc2VtaWPDrXJjdWxvcyAocmVwcmVzZW50YW5kbyBsYXMgNyBwcm92aW5jaWFzKSAtLT4KICA8Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iNDAiIGZpbGw9IiMzOTRBOUEiIG9wYWNpdHk9IjAuMSIvPgogIDxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSIzNSIgZmlsbD0iIzM5NEE5QSIgb3BhY2l0eT0iMC4yIi8+CiAgPGNpcmNsZSBjeD0iLTE1IiBjeT0iLTE1IiByPSIxNSIgZmlsbD0iIzM5NEE5QSIgb3BhY2l0eT0iMC4zIi8+CiAgPGNpcmNsZSBjeD0iMTUiIGN5PSItMTUiIHI9IjEyIiBmaWxsPSIjMzk0QTlBIiBvcGFjaXR5PSIwLjQiLz4KICA8Y2lyY2xlIGN4PSIxOCIgY3k9IjEyIiByPSIxMCIgZmlsbD0iIzM5NEE5QSIgb3BhY2l0eT0iMC41Ii8+CiAgPGNpcmNsZSBjeD0iLTE4IiBjeT0iMTIiIHI9IjExIiBmaWxsPSIjMzk0QTlBIiBvcGFjaXR5PSIwLjYiLz4KICA8Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iOCIgZmlsbD0iIzM5NEE5QSIvPgogIDwhLS0gUHVwaWxhIGNlbnRyYWwgLS0+CiAgPGNpcmNsZSBjeD0iMCIgY3k9IjAiIHI9IjQiIGZpbGw9IndoaXRlIi8+CjwvZz4KCjwhLS0gVGV4dG8gQ0dSIC0tPgo8dGV4dCB4PSIxMjAiIHk9IjIwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkNlbnR1cnkgR290aGljLCBBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI0OCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IiMzOTRBOUEiPkNHUjwvdGV4dD4KPC9zdmc+" 
                     alt="CGR - Contralor√≠a General de la Rep√∫blica" 
                     style="width: 120px; height: 120px; flex-shrink: 0;" />
                
                <div style="text-align: left;">
                    <h1 style="margin: 0;">üî¨ Laboratorio de Riesgos</h1>
                    <p style="margin: 0; font-size: 1.2rem; color: var(--primary-color); font-weight: 600;">
                        Contralor√≠a General de la Rep√∫blica
                    </p>
                    <p style="margin: 0.5rem 0 0 0;">Transformaci√≥n Digital en Gesti√≥n de Riesgos</p>
                </div>
            </div>
            
            <!-- L√≠nea decorativa en colores CGR -->
            <div style="height: 4px; background: linear-gradient(90deg, var(--primary-color) 0%, var(--accent-color) 50%, var(--success-color) 100%); margin-top: 1rem; border-radius: 2px;"></div>
        </header>

        <nav class="main-nav">
            <button class="nav-button active" onclick="showModule('inicio')">üè† Inicio</button>
            <button class="nav-button" onclick="showModule('modulo1')">üìö Gu√≠a Interactiva</button>
            <button class="nav-button" onclick="showModule('modulo2')">üå°Ô∏è Mapa de Calor</button>
            <button class="nav-button" onclick="showModule('modulo3')">üî® Constructor de Riesgos</button>
        </nav>

        <!-- Secci√≥n de Inicio -->
        <div id="inicio" class="module active">
            <div class="intro-section">
                <h2>¬øQu√© es el Laboratorio de Riesgos?</h2>
                <p>Una plataforma integral que centraliza, analiza y optimiza la gesti√≥n de riesgos institucionales mediante inteligencia artificial y herramientas interactivas, transformando datos en conocimiento accionable.</p>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-icon" style="color: var(--primary-color);">üìö</div>
                        <h3 style="color: var(--primary-color); font-family: 'Century Gothic', 'Arial', sans-serif;">Gu√≠a Interactiva</h3>
                        <p>Nivelaci√≥n de conocimientos sobre conceptos clave de gesti√≥n de riesgos y MOSEVRI</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon" style="color: var(--accent-color);">üå°Ô∏è</div>
                        <h3 style="color: var(--primary-color); font-family: 'Century Gothic', 'Arial', sans-serif;">Mapa de Calor</h3>
                        <p>Visualizaci√≥n avanzada de riesgos cr√≠ticos con matrices interactivas y reportes din√°micos</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon" style="color: var(--success-color);">üî®</div>
                        <h3 style="color: var(--primary-color); font-family: 'Century Gothic', 'Arial', sans-serif;">Constructor de Riesgos</h3>
                        <p>Automatizaci√≥n inteligente para el llenado del Anexo 2 de MOSEVRI con IA predictiva</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- M√≥dulo 1: Gu√≠a Interactiva de Riesgos -->
        <div id="modulo1" class="module">
            <h2><span class="module-icon">üìö</span>Gu√≠a Interactiva de Riesgos</h2>
            <p>Espacio de consulta para brindar informaci√≥n clara y estructurada sobre conceptos y caracter√≠sticas de la gesti√≥n de riesgos.</p>
            
            <div class="glossary-grid">
                <div class="concept-card" onclick="toggleConcept('riesgo')">
                    <h3>¬øQu√© es Riesgo? üéØ</h3>
                    <p>Conceptos fundamentales sobre riesgos</p>
                    <div id="riesgo" class="concept-detail">
                        <strong>Definici√≥n:</strong> Probabilidad de que ocurran eventos que tendr√≠an consecuencias sobre el cumplimiento de los objetivos fijados.
                        <br><br>
                        <strong>Tipos de riesgo:</strong>
                        <ul>
                            <li><strong>Riesgo Inherente:</strong> Nivel de riesgo antes de controles</li>
                            <li><strong>Riesgo Residual:</strong> Nivel de riesgo despu√©s de controles</li>
                            <li><strong>Riesgo Aceptable:</strong> Nivel al que la entidad est√° dispuesta a exponerse</li>
                        </ul>
                    </div>
                </div>

                <div class="concept-card" onclick="toggleConcept('mosevri')">
                    <h3>MOSEVRI üìã</h3>
                    <p>Marco Orientador del Sistema Espec√≠fico de Valoraci√≥n del Riesgo</p>
                    <div id="mosevri" class="concept-detail">
                        <strong>√Åmbitos de aplicaci√≥n:</strong>
                        <ul>
                            <li><strong>Estrat√©gicos:</strong> Plan Estrat√©gico Institucional (PEI)</li>
                            <li><strong>T√°cticos:</strong> Proyectos de mejora continua</li>
                            <li><strong>Operativos:</strong> Procedimientos espec√≠ficos</li>
                        </ul>
                        <br>
                        <strong>Tipos de riesgo seg√∫n objetivos del SCII:</strong>
                        <ul>
                            <li>Patrimoniales</li>
                            <li>De cumplimiento</li>
                            <li>Operacionales</li>
                            <li>De informaci√≥n</li>
                        </ul>
                    </div>
                </div>

                <div class="concept-card" onclick="toggleConcept('especiales')">
                    <h3>Riesgos Especiales üîí</h3>
                    <p>Riesgos complementarios al MOSEVRI</p>
                    <div id="especiales" class="concept-detail">
                        <strong>Incluye:</strong>
                        <ul>
                            <li><strong>Continuidad del Negocio:</strong> Riesgos que afectan la operaci√≥n continua</li>
                            <li><strong>Ciberseguridad:</strong> Amenazas digitales y de informaci√≥n</li>
                            <li><strong>Salud Ocupacional:</strong> Riesgos laborales y de bienestar</li>
                            <li><strong>Riesgos de IA:</strong> Asociados al uso de inteligencia artificial</li>
                        </ul>
                    </div>
                </div>

                <div class="concept-card" onclick="toggleConcept('proceso')">
                    <h3>Proceso de Gesti√≥n üîÑ</h3>
                    <p>Causa - Evento - Consecuencia</p>
                    <div id="proceso" class="concept-detail">
                        <strong>Causa:</strong> Situaciones internas o externas que podr√≠an originar un evento.
                        <br><br>
                        <strong>Evento:</strong> Incidente con impacto potencial (amenaza u oportunidad).
                        <br><br>
                        <strong>Consecuencia:</strong> Efectos derivados de la ocurrencia del evento.
                        <br><br>
                        <strong>Valoraci√≥n:</strong>
                        <ul>
                            <li>Probabilidad: Alta=3, Media=2, Baja=1</li>
                            <li>Magnitud: Alta=3, Media=2, Baja=1</li>
                        </ul>
                    </div>
                </div>

                <div class="concept-card" onclick="toggleConcept('etico')">
                    <h3>Riesgo √âtico ‚öñÔ∏è</h3>
                    <p>Probabilidad de acontecimientos contrarios a la √©tica</p>
                    <div id="etico" class="concept-detail">
                        <strong>Definici√≥n:</strong> Probabilidad de que ocurran acontecimientos contrarios a la √©tica que afecten negativamente a la organizaci√≥n en el cumplimiento de objetivos y evidencien falta de probidad del personal.
                        <br><br>
                        <strong>Ejemplos por tipo:</strong>
                        <ul>
                            <li><strong>Patrimoniales:</strong> Conflicto de inter√©s, desv√≠o de recursos, hurto</li>
                            <li><strong>Cumplimiento:</strong> Fraude de ley, aceptaci√≥n de sobornos</li>
                            <li><strong>Operacionales:</strong> Simulaci√≥n de resultados</li>
                            <li><strong>Informaci√≥n:</strong> Uso indebido de informaci√≥n, acceso no autorizado</li>
                        </ul>
                    </div>
                </div>

                <div class="concept-card" onclick="toggleConcept('controles')">
                    <h3>Controles y Medidas üõ°Ô∏è</h3>
                    <p>Medidas de administraci√≥n del riesgo</p>
                    <div id="controles" class="concept-detail">
                        <strong>Componentes del Sistema de Control Interno:</strong>
                        <ul>
                            <li><strong>Ambiente de Control:</strong> Cultura organizacional</li>
                            <li><strong>Valoraci√≥n del Riesgo:</strong> Identificaci√≥n y an√°lisis</li>
                            <li><strong>Actividades de Control:</strong> Pol√≠ticas y procedimientos</li>
                            <li><strong>Sistemas de Informaci√≥n:</strong> Comunicaci√≥n efectiva</li>
                            <li><strong>Seguimiento:</strong> Monitoreo continuo</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- M√ìDULO 2: AN√ÅLISIS DE RIESGOS AVANZADO -->
        <div id="modulo2" class="module">
            <div class="module-header">
                <h2><span class="module-icon">üå°Ô∏è</span>An√°lisis Avanzado de Riesgos</h2>
                <p>Visualizaci√≥n interactiva y an√°lisis detallado de la matriz de riesgos institucional</p>
            </div>

            <!-- ESTAD√çSTICAS DEL M√ìDULO -->
            <div class="stats-grid">
                <div class="stat-card total">
                    <div class="stat-number" id="totalRisks">0</div>
                    <div class="stat-label">Riesgos Filtrados</div>
                </div>
                <div class="stat-card alto">
                    <div class="stat-number alto" id="highRisks">0</div>
                    <div class="stat-label">Cr√≠ticos</div>
                </div>
                <div class="stat-card medio">
                    <div class="stat-number" id="mediumRisks">0</div>
                    <div class="stat-label">Moderados</div>
                </div>
                <div class="stat-card bajo">
                    <div class="stat-number" id="lowRisks">0</div>
                    <div class="stat-label">Controlados</div>
                </div>
            </div>

            <!-- GR√ÅFICO DE AN√ÅLISIS -->
            <div class="chart-section">
                <div class="chart-header">
                    <h3 class="chart-title">üìà An√°lisis de Distribuci√≥n</h3>
                </div>
                <div class="chart-container">
                    <canvas id="analysisChart" width="300" height="300" class="chart-canvas"></canvas>
                </div>
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--gradient-accent);"></div>
                        <span class="legend-text">Riesgos Altos</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--warning-color);"></div>
                        <span class="legend-text">Riesgos Medios</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--success-color);"></div>
                        <span class="legend-text">Riesgos Bajos</span>
                    </div>
                </div>
            </div>

            <!-- SISTEMA DE FILTROS AVANZADO -->
            <div class="filters-section">
                <div class="filters-header">
                    <h3 class="filters-title">üîç Filtros de An√°lisis</h3>
                    <button class="clear-all-btn" onclick="clearAllFilters()">Limpiar Todo</button>
                </div>
                
                <div class="filters-grid">
                    <div class="filter-group">
                        <label class="filter-label">üè¢ Divisi√≥n CGR</label>
                        <select class="filter-input" id="divisionFilter" onchange="applyFilters()">
                            <option value="">Todas las divisiones</option>
                            <option value="dfoe">Divisi√≥n de Fiscalizaci√≥n Operativa</option>
                            <option value="dcp">Divisi√≥n de Contrataci√≥n P√∫blica</option>
                            <option value="dga">Divisi√≥n de Gesti√≥n de Apoyo</option>
                            <option value="dj">Divisi√≥n Jur√≠dica</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">üéØ Tipo de Riesgo</label>
                        <select class="filter-input" id="typeFilter" onchange="applyFilters()">
                            <option value="">Todos los tipos</option>
                            <option value="patrimoniales">Patrimoniales</option>
                            <option value="cumplimiento">Cumplimiento</option>
                            <option value="operacionales">Operacionales</option>
                            <option value="informacion">Informaci√≥n</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">‚ö†Ô∏è Nivel de Criticidad</label>
                        <select class="filter-input" id="levelFilter" onchange="applyFilters()">
                            <option value="">Todos los niveles</option>
                            <option value="alto">Alto</option>
                            <option value="medio">Medio</option>
                            <option value="bajo">Bajo</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">üîç B√∫squeda Textual</label>
                        <input type="text" class="filter-input" id="searchFilter" 
                               placeholder="Buscar en eventos, causas, consecuencias..." 
                               onkeyup="applyFilters()">
                    </div>
                </div>

                <div class="active-filters" id="activeFilters"></div>
            </div>

            <!-- CONTROLES DE VISTA -->
            <div class="heatmap-section">
                <div class="heatmap-header">
                    <h3 class="heatmap-title">üó∫Ô∏è Mapa de Calor de Riesgos</h3>
                    <div class="view-controls">
                        <button class="view-btn active" onclick="setView('grid')" data-view="grid">üì± Tarjetas</button>
                        <button class="view-btn" onclick="setView('table')" data-view="table">üìã Tabla</button>
                    </div>
                </div>

                <!-- MAPA DE CALOR DIN√ÅMICO -->
                <div class="risk-grid" id="riskGrid"></div>
            </div>

            <!-- GENERACI√ìN DE REPORTES -->
            <div class="reports-section">
                <h3 class="reports-title">üìä Generaci√≥n de Reportes</h3>
                <div class="reports-grid">
                    <button class="report-btn" onclick="generateAdvancedReport('executive')">
                        üìÑ Reporte Ejecutivo
                    </button>
                    <button class="report-btn" onclick="generateAdvancedReport('detailed')">
                        üìã An√°lisis Detallado
                    </button>
                    <button class="report-btn accent" onclick="generateAdvancedReport('trends')">
                        üìà Tendencias
                    </button>
                    <button class="report-btn" onclick="generateAdvancedReport('matrix')">
                        üóÇÔ∏è Matriz Completa
                    </button>
                </div>
            </div>
        </div>

        <!-- M√ìDULO 3: CONSTRUCTOR CON IA -->
        <div id="modulo3" class="module">
            <div class="module-header">
                <h2><span class="module-icon">üî®</span>Constructor de Riesgos con IA</h2>
                <p>Generaci√≥n autom√°tica de an√°lisis de riesgos utilizando inteligencia artificial</p>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                <!-- FORMULARIO DE ENTRADA -->
                <div style="background: white; padding: 2rem; border-radius: 16px; box-shadow: var(--shadow-light);">
                    <h3 style="color: var(--primary-color); margin-bottom: 1.5rem;">üìù Datos de Entrada</h3>
                    
                    <form id="riskConstructorForm" onsubmit="generateRiskAnalysis(event)">
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Evento Probable *</label>
                            <textarea id="eventoProblable" required
                                style="width: 100%; min-height: 100px; padding: 0.75rem; border: 2px solid var(--cgr-gray); border-radius: 8px; resize: vertical;"
                                placeholder="Describa el evento de riesgo que podr√≠a ocurrir..."></textarea>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Procedimiento *</label>
                            <select id="tipoProcedimiento" required 
                                style="width: 100%; padding: 0.75rem; border: 2px solid var(--cgr-gray); border-radius: 8px;">
                                <option value="">Seleccione un procedimiento</option>
                                <option value="financiero">Gesti√≥n Financiero-Contable</option>
                                <option value="denuncias">Atenci√≥n de Denuncias</option>
                                <option value="auditoria">Auditor√≠a</option>
                                <option value="contratacion">Contrataci√≥n P√∫blica</option>
                                <option value="juridica">Asesor√≠a Jur√≠dica</option>
                                <option value="rrhh">Recursos Humanos</option>
                                <option value="ti">Tecnolog√≠as de Informaci√≥n</option>
                            </select>
                        </div>

                        <button type="submit" class="report-btn" style="width: 100%;">
                            ü§ñ Generar An√°lisis con IA
                        </button>
                    </form>
                </div>

                <!-- RESULTADOS DE IA -->
                <div style="background: white; padding: 2rem; border-radius: 16px; box-shadow: var(--shadow-light);">
                    <h3 style="color: var(--primary-color); margin-bottom: 1.5rem;">üß† An√°lisis Generado por IA</h3>
                    <div id="aiResults" style="color: var(--medium-gray); text-align: center; padding: 2rem;">
                        Ingrese los datos y presione "Generar An√°lisis" para ver los resultados de la IA
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DATOS DE MUESTRA EXTENDIDOS
        const riskDatabase = [
            {
                id: 1,
                evento: "Fallas cr√≠ticas en sistema de informaci√≥n financiera",
                division: "dga", tipo: "informacion", nivel: "alto",
                probabilidad: 3, magnitud: 3,
                causa: "Obsolescencia tecnol√≥gica y falta de mantenimiento",
                consecuencia: "Errores en reportes financieros y p√©rdida de confianza",
                procedimiento: "Gesti√≥n financiero-contable"
            },
            {
                id: 2,
                evento: "Retrasos significativos en atenci√≥n de denuncias",
                division: "dfoe", tipo: "operacionales", nivel: "medio",
                probabilidad: 2, magnitud: 3,
                causa: "Sobrecarga de trabajo y recursos limitados",
                consecuencia: "P√©rdida de confianza ciudadana e imagen institucional",
                procedimiento: "Atenci√≥n de denuncias"
            },
            {
                id: 3,
                evento: "Conflicto de inter√©s en procesos de contrataci√≥n",
                division: "dcp", tipo: "patrimoniales", nivel: "alto",
                probabilidad: 2, magnitud: 3,
                causa: "Controles preventivos insuficientes",
                consecuencia: "Da√±o reputacional y p√©rdidas econ√≥micas",
                procedimiento: "Contrataci√≥n p√∫blica"
            },
            {
                id: 4,
                evento: "P√©rdida de documentos legales cr√≠ticos",
                division: "dj", tipo: "cumplimiento", nivel: "medio",
                probabilidad: 2, magnitud: 2,
                causa: "Sistema de archivo f√≠sico deficiente",
                consecuencia: "Retrasos en procesos legales",
                procedimiento: "Asesor√≠a jur√≠dica"
            },
            {
                id: 5,
                evento: "Filtraci√≥n de informaci√≥n confidencial",
                division: "dfoe", tipo: "informacion", nivel: "alto",
                probabilidad: 2, magnitud: 3,
                causa: "Accesos no autorizados y controles d√©biles",
                consecuencia: "Comprometimiento de investigaciones",
                procedimiento: "Auditor√≠a"
            },
            {
                id: 6,
                evento: "Errores en c√°lculo de remuneraciones",
                division: "dga", tipo: "patrimoniales", nivel: "bajo",
                probabilidad: 1, magnitud: 2,
                causa: "Error humano en procesamiento",
                consecuencia: "Pagos incorrectos y reclamos",
                procedimiento: "Pago de planillas"
            },
            {
                id: 7,
                evento: "Incumplimiento normativa ambiental",
                division: "dga", tipo: "cumplimiento", nivel: "medio",
                probabilidad: 2, magnitud: 2,
                causa: "Desconocimiento de nuevas regulaciones",
                consecuencia: "Sanciones y multas administrativas",
                procedimiento: "Gesti√≥n ambiental"
            },
            {
                id: 8,
                evento: "Fraude en licitaci√≥n p√∫blica",
                division: "dcp", tipo: "patrimoniales", nivel: "alto",
                probabilidad: 1, magnitud: 3,
                causa: "Controles internos d√©biles",
                consecuencia: "P√©rdidas econ√≥micas y da√±o reputacional",
                procedimiento: "Licitaci√≥n p√∫blica"
            },
            {
                id: 9,
                evento: "Ciberataque a infraestructura cr√≠tica",
                division: "dga", tipo: "informacion", nivel: "alto",
                probabilidad: 2, magnitud: 3,
                causa: "Vulnerabilidades de seguridad no parcheadas",
                consecuencia: "Interrupci√≥n de servicios cr√≠ticos",
                procedimiento: "Gesti√≥n de TI"
            },
            {
                id: 10,
                evento: "Rotaci√≥n alta de personal especializado",
                division: "dga", tipo: "operacionales", nivel: "medio",
                probabilidad: 3, magnitud: 2,
                causa: "Condiciones laborales no competitivas",
                consecuencia: "P√©rdida de conocimiento institucional",
                procedimiento: "Gesti√≥n de RRHH"
            }
        ];

        let filteredRisks = [...riskDatabase];
        let currentView = 'grid';
        let activeFilters = {};

        // FUNCIONES DE NAVEGACI√ìN
        function showModule(moduleId) {
            // Actualizar navegaci√≥n
            document.querySelectorAll('.module').forEach(m => m.classList.remove('active'));
            document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
            
            document.getElementById(moduleId).classList.add('active');
            document.querySelector(`[data-module="${moduleId}"]`).classList.add('active');

            // Inicializar datos espec√≠ficos del m√≥dulo
            if (moduleId === 'inicio') {
                updateDashboardStats();
                updateDashboardChart();
            } else if (moduleId === 'modulo2') {
                setTimeout(() => {
                    updateModuleStats();
                    updateAnalysisChart();
                    renderRiskGrid();
                }, 100);
            }
        }

        // FUNCIONES DE ESTAD√çSTICAS ANIMADAS
        function animateCounter(elementId, targetValue, suffix = '') {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const startValue = parseInt(element.textContent) || 0;
            const duration = 1500;
            const steps = 60;
            const increment = (targetValue - startValue) / steps;
            
            let current = startValue;
            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= targetValue) || 
                    (increment < 0 && current <= targetValue)) {
                    current = targetValue;
                    clearInterval(timer);
                }
                element.textContent = Math.round(current) + suffix;
            }, duration / steps);
        }

        function updateDashboardStats() {
            const total = riskDatabase.length;
            const high = riskDatabase.filter(r => r.nivel === 'alto').length;
            const medium = riskDatabase.filter(r => r.nivel === 'medio').length;
            const low = riskDatabase.filter(r => r.nivel === 'bajo').length;
            
            animateCounter('dashTotalRisks', total);
            animateCounter('dashHighRisks', high);
            animateCounter('dashMediumRisks', medium);
            animateCounter('dashLowRisks', low);
            
            const avgScore = riskDatabase.reduce((sum, r) => sum + (r.probabilidad * r.magnitud), 0) / total;
            animateCounter('dashRiskScore', avgScore.toFixed(1));
        }

        function updateModuleStats() {
            const total = filteredRisks.length;
            const high = filteredRisks.filter(r => r.nivel === 'alto').length;
            const medium = filteredRisks.filter(r => r.nivel === 'medio').length;
            const low = filteredRisks.filter(r => r.nivel === 'bajo').length;
            
            animateCounter('totalRisks', total);
            animateCounter('highRisks', high);
            animateCounter('mediumRisks', medium);
            animateCounter('lowRisks', low);
        }

        // FUNCIONES DE GR√ÅFICOS INTERACTIVOS
        function drawDonutChart(canvasId, high, medium, low) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const outerRadius = 120;
            const innerRadius = 70;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const total = high + medium + low;
            if (total === 0) {
                ctx.fillStyle = '#64748b';
                ctx.font = '16px Century Gothic';
                ctx.textAlign = 'center';
                ctx.fillText('Sin datos', centerX, centerY);
                return;
            }

            const colors = ['#EA7305', '#f8ae40', '#28a9e0'];
            const values = [high, medium, low];
            const labels = ['Cr√≠ticos', 'Moderados', 'Controlados'];
            
            let currentAngle = -Math.PI / 2;
            
            values.forEach((value, index) => {
                if (value > 0) {
                    const sliceAngle = (value / total) * 2 * Math.PI;
                    
                    // Dibujar segmento
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, outerRadius, currentAngle, currentAngle + sliceAngle);
                    ctx.arc(centerX, centerY, innerRadius, currentAngle + sliceAngle, currentAngle, true);
                    ctx.closePath();
                    ctx.fillStyle = colors[index];
                    ctx.fill();
                    
                    // Efecto de sombra
                    ctx.shadowColor = 'rgba(0,0,0,0.1)';
                    ctx.shadowBlur = 10;
                    ctx.fill();
                    ctx.shadowBlur = 0;
                    
                    currentAngle += sliceAngle;
                }
            });
            
            // Texto central
            ctx.fillStyle = '#394A9A';
            ctx.font = 'bold 28px Century Gothic';
            ctx.textAlign = 'center';
            ctx.fillText(total, centerX, centerY - 5);
            ctx.font = '14px Century Gothic';
            ctx.fillText('Total', centerX, centerY + 20);
        }

        function updateDashboardChart() {
            const high = riskDatabase.filter(r => r.nivel === 'alto').length;
            const medium = riskDatabase.filter(r => r.nivel === 'medio').length;
            const low = riskDatabase.filter(r => r.nivel === 'bajo').length;
            
            drawDonutChart('dashChart', high, medium, low);
        }

        function updateAnalysisChart() {
            const high = filteredRisks.filter(r => r.nivel === 'alto').length;
            const medium = filteredRisks.filter(r => r.nivel === 'medio').length;
            const low = filteredRisks.filter(r => r.nivel === 'bajo').length;
            
            drawDonutChart('analysisChart', high, medium, low);
        }

        // SISTEMA DE FILTROS AVANZADO
        function applyFilters() {
            const division = document.getElementById('divisionFilter').value;
            const type = document.getElementById('typeFilter').value;
            const level = document.getElementById('levelFilter').value;
            const search = document.getElementById('searchFilter').value.toLowerCase();

            activeFilters = { division, type, level, search };
            
            filteredRisks = riskDatabase.filter(risk => {
                const matchesDivision = !division || risk.division === division;
                const matchesType = !type || risk.tipo === type;
                const matchesLevel = !level || risk.nivel === level;
                const matchesSearch = !search || 
                    risk.evento.toLowerCase().includes(search) ||
                    risk.causa.toLowerCase().includes(search) ||
                    risk.consecuencia.toLowerCase().includes(search) ||
                    risk.procedimiento.toLowerCase().includes(search);
                    
                return matchesDivision && matchesType && matchesLevel && matchesSearch;
            });

            updateActiveFilters();
            updateModuleStats();
            updateAnalysisChart();
            renderRiskGrid();
        }

        function updateActiveFilters() {
            const container = document.getElementById('activeFilters');
            if (!container) return;
            
            container.innerHTML = '';
            
            const filterLabels = {
                division: 'üè¢',
                type: 'üéØ', 
                level: '‚ö†Ô∏è',
                search: 'üîç'
            };

            Object.entries(activeFilters).forEach(([key, value]) => {
                if (value) {
                    const badge = document.createElement('div');
                    badge.className = 'filter-badge';
                    badge.innerHTML = `
                        ${filterLabels[key]} ${value}
                        <button class="filter-badge-remove" onclick="removeFilter('${key}')">‚úï</button>
                    `;
                    container.appendChild(badge);
                }
            });
        }

        function removeFilter(filterKey) {
            const elementIds = {
                division: 'divisionFilter',
                type: 'typeFilter',
                level: 'levelFilter',
                search: 'searchFilter'
            };
            
            document.getElementById(elementIds[filterKey]).value = '';
            applyFilters();
        }

        function clearAllFilters() {
            document.getElementById('divisionFilter').value = '';
            document.getElementById('typeFilter').value = '';
            document.getElementById('levelFilter').value = '';
            document.getElementById('searchFilter').value = '';
            applyFilters();
        }

        // MAPA DE CALOR DIN√ÅMICO
        function renderRiskGrid() {
            const container = document.getElementById('riskGrid');
            if (!container) return;
            
            if (filteredRisks.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        <div class="no-data-icon">üìä</div>
                        <h3>No se encontraron riesgos</h3>
                        <p>Ajuste los filtros para ver resultados</p>
                    </div>
                `;
                return;
            }
            
            const sortedRisks = [...filteredRisks].sort((a, b) => {
                const scoreA = a.probabilidad * a.magnitud;
                const scoreB = b.probabilidad * b.magnitud;
                return scoreB - scoreA;
            });
            
            container.innerHTML = sortedRisks.map((risk, index) => `
                <div class="risk-card ${risk.nivel}" style="animation-delay: ${index * 0.1}s;">
                    <div class="risk-header">
                        <div class="risk-level ${risk.nivel}">${risk.nivel.toUpperCase()}</div>
                        <div class="risk-score">Score: ${risk.probabilidad * risk.magnitud}</div>
                    </div>
                    <div class="risk-content">
                        <h4 class="risk-title">${risk.evento}</h4>
                        <div class="risk-details">
                            <div class="risk-detail">
                                <span class="risk-icon">üè¢</span>
                                <span><strong>Procedimiento:</strong> ${risk.procedimiento}</span>
                            </div>
                            <div class="risk-detail">
                                <span class="risk-icon">üéØ</span>
                                <span><strong>Tipo:</strong> ${risk.tipo.charAt(0).toUpperCase() + risk.tipo.slice(1)}</span>
                            </div>
                            <div class="risk-detail">
                                <span class="risk-icon">‚ö†Ô∏è</span>
                                <span><strong>Causa:</strong> ${risk.causa}</span>
                            </div>
                            <div class="risk-detail">
                                <span class="risk-icon">üí•</span>
                                <span><strong>Consecuencia:</strong> ${risk.consecuencia}</span>
                            </div>
                        </div>
                        <div class="risk-metrics">
                            <div class="metric">
                                <div class="metric-value">${risk.probabilidad}</div>
                                <div class="metric-label">Probabilidad</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">${risk.magnitud}</div>
                                <div class="metric-label">Impacto</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">${risk.probabilidad * risk.magnitud}</div>
                                <div class="metric-label">Riesgo</div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // CONTROLES DE VISTA
        function setView(viewType) {
            currentView = viewType;
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === viewType);
            });
            renderRiskGrid();
        }

        // GENERACI√ìN DE REPORTES AVANZADOS
        function generateAdvancedReport(type) {
            if (filteredRisks.length === 0) {
                alert('‚ö†Ô∏è No hay datos para generar el reporte. Ajuste los filtros.');
                return;
            }

            const stats = {
                total: filteredRisks.length,
                high: filteredRisks.filter(r => r.nivel === 'alto').length,
                medium: filteredRisks.filter(r => r.nivel === 'medio').length,
                low: filteredRisks.filter(r => r.nivel === 'bajo').length,
                avgScore: (filteredRisks.reduce((sum, r) => sum + (r.probabilidad * r.magnitud), 0) / filteredRisks.length).toFixed(2),
                date: new Date().toLocaleDateString('es-CR', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                })
            };

            let report = `üìä REPORTE ${type.toUpperCase()} - LABORATORIO DE RIESGOS CGR\n`;
            report += `${'='.repeat(60)}\n\n`;
            report += `üìÖ Fecha: ${stats.date}\n`;
            report += `üèõÔ∏è Instituci√≥n: Contralor√≠a General de la Rep√∫blica\n`;
            report += `üìã Riesgos analizados: ${stats.total}\n\n`;
            
            report += `üìà RESUMEN EJECUTIVO:\n`;
            report += `‚Ä¢ Riesgos cr√≠ticos: ${stats.high} (${((stats.high/stats.total)*100).toFixed(1)}%)\n`;
            report += `‚Ä¢ Riesgos moderados: ${stats.medium} (${((stats.medium/stats.total)*100).toFixed(1)}%)\n`;
            report += `‚Ä¢ Riesgos controlados: ${stats.low} (${((stats.low/stats.total)*100).toFixed(1)}%)\n`;
            report += `‚Ä¢ Score promedio: ${stats.avgScore}/9\n\n`;

            if (type === 'trends') {
                report += `üìâ AN√ÅLISIS DE TENDENCIAS:\n`;
                report += `‚Ä¢ Riesgos que requieren atenci√≥n inmediata: ${stats.high}\n`;
                report += `‚Ä¢ Distribuci√≥n de riesgo m√°s com√∫n: ${getMostCommonRiskType()}\n`;
                report += `‚Ä¢ Divisi√≥n con mayor exposici√≥n: ${getMostRiskyDivision()}\n`;
                report += `‚Ä¢ Procedimiento m√°s cr√≠tico: ${getMostCriticalProcedure()}\n\n`;
            }

            if (type === 'detailed') {
                report += `üìã AN√ÅLISIS DETALLADO POR RIESGO:\n`;
                filteredRisks.forEach((risk, index) => {
                    report += `\n${index + 1}. ${risk.evento}\n`;
                    report += `   ‚Ä¢ Nivel: ${risk.nivel.toUpperCase()}\n`;
                    report += `   ‚Ä¢ Score: ${risk.probabilidad * risk.magnitud}\n`;
                    report += `   ‚Ä¢ Divisi√≥n: ${getDivisionName(risk.division)}\n`;
                    report += `   ‚Ä¢ Causa: ${risk.causa}\n`;
                });
            }

            report += `\n${'='.repeat(60)}\n`;
            report += `üèõÔ∏è Contralor√≠a General de la Rep√∫blica - Costa Rica\n`;
            report += `üìß Laboratorio de Riesgos - Versi√≥n 2.3\n`;

            // Simular descarga del reporte
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Reporte_${type}_${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert(`‚úÖ Reporte ${type.toUpperCase()} generado exitosamente!\n\nArchivo descargado: Reporte_${type}_${Date.now()}.txt`);
        }

        // FUNCIONES AUXILIARES PARA REPORTES
        function getMostCommonRiskType() {
            const types = filteredRisks.reduce((acc, risk) => {
                acc[risk.tipo] = (acc[risk.tipo] || 0) + 1;
                return acc;
            }, {});
            
            const mostCommon = Object.keys(types).reduce((a, b) => types[a] > types[b] ? a : b, '');
            return mostCommon ? mostCommon.charAt(0).toUpperCase() + mostCommon.slice(1) : 'N/A';
        }

        function getMostRiskyDivision() {
            const divisions = filteredRisks.reduce((acc, risk) => {
                acc[risk.division] = (acc[risk.division] || 0) + (risk.probabilidad * risk.magnitud);
                return acc;
            }, {});
            
            const mostRisky = Object.keys(divisions).reduce((a, b) => divisions[a] > divisions[b] ? a : b, '');
            return getDivisionName(mostRisky);
        }

        function getMostCriticalProcedure() {
            const procedures = filteredRisks.reduce((acc, risk) => {
                acc[risk.procedimiento] = (acc[risk.procedimiento] || 0) + (risk.probabilidad * risk.magnitud);
                return acc;
            }, {});
            
            return Object.keys(procedures).reduce((a, b) => procedures[a] > procedures[b] ? a : b, 'N/A');
        }

        function getDivisionName(code) {
            const names = {
                'dfoe': 'Divisi√≥n de Fiscalizaci√≥n Operativa y Evaluativa',
                'dcp': 'Divisi√≥n de Contrataci√≥n P√∫blica',
                'dga': 'Divisi√≥n de Gesti√≥n de Apoyo',
                'dj': 'Divisi√≥n Jur√≠dica'
            };
            return names[code] || code;
        }

        // CONSTRUCTOR DE RIESGOS CON IA
        function generateRiskAnalysis(event) {
            event.preventDefault();
            
            const evento = document.getElementById('eventoProblable').value;
            const procedimiento = document.getElementById('tipoProcedimiento').value;
            
            if (!evento || !procedimiento) {
                alert('‚ö†Ô∏è Por favor complete todos los campos obligatorios.');
                return;
            }

            // Simular procesamiento de IA
            const aiResults = document.getElementById('aiResults');
            aiResults.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">ü§ñ</div>
                    <p style="color: var(--primary-color); font-weight: bold;">Procesando con IA...</p>
                    <div style="margin-top: 1rem;">
                        <div style="width: 100%; height: 4px; background: var(--cgr-gray); border-radius: 2px; overflow: hidden;">
                            <div style="width: 0%; height: 100%; background: var(--gradient-primary); animation: loadingBar 3s ease-in-out forwards;"></div>
                        </div>
                    </div>
                </div>
            `;

            // Simular an√°lisis con IA
            setTimeout(() => {
                const analysis = performAIAnalysis(evento, procedimiento);
                displayAIResults(analysis);
            }, 3000);
        }

        function performAIAnalysis(evento, procedimiento) {
            const keywords = evento.toLowerCase();
            let analysis = {
                eventoMejorado: evento,
                tipoRiesgo: 'Operacionales',
                riesgoEtico: 'No',
                causas: ['Causa identificada por IA'],
                consecuencias: ['Consecuencia analizada por IA'],
                probabilidad: 2,
                magnitud: 2,
                controles: ['Control sugerido por IA'],
                recomendaciones: ['Recomendaci√≥n de mejora']
            };

            // An√°lisis inteligente basado en palabras clave
            if (keywords.includes('ciberseguridad') || keywords.includes('ciberataque') || keywords.includes('hackeo')) {
                analysis = {
                    eventoMejorado: `Ciberataque dirigido a sistemas cr√≠ticos de informaci√≥n institucional que compromete la integridad, disponibilidad y confidencialidad de datos sensibles`,
                    tipoRiesgo: 'Informaci√≥n',
                    riesgoEtico: 'S√≠ - Potencial acceso indebido a informaci√≥n confidencial',
                    causas: [
                        'Vulnerabilidades en sistemas de seguridad inform√°tica no parcheadas',
                        'Falta de capacitaci√≥n en ciberseguridad del personal',
                        'Controles de acceso insuficientes a sistemas cr√≠ticos',
                        'Ausencia de monitoreo continuo de amenazas'
                    ],
                    consecuencias: [
                        'P√©rdida de informaci√≥n confidencial y sensible',
                        'Interrupci√≥n de servicios cr√≠ticos institucionales',
                        'Da√±o severo a la reputaci√≥n institucional',
                        'Costos significativos de recuperaci√≥n y remediaci√≥n',
                        'Posibles sanciones por incumplimiento normativo'
                    ],
                    probabilidad: 3,
                    magnitud: 3,
                    controles: [
                        'Implementar monitoreo SOC 24/7',
                        'Actualizar plan de continuidad de negocio',
                        'Establecer programa de capacitaci√≥n continua',
                        'Implementar autenticaci√≥n multifactor',
                        'Realizar auditor√≠as de seguridad peri√≥dicas'
                    ],
                    recomendaciones: [
                        'Crear comit√© de ciberseguridad institucional',
                        'Establecer protocolos de respuesta a incidentes',
                        'Implementar backup autom√°tico y cifrado',
                        'Desarrollar plan de comunicaci√≥n de crisis'
                    ]
                };
            } else if (keywords.includes('corrupci√≥n') || keywords.includes('fraude') || keywords.includes('conflicto')) {
                analysis = {
                    eventoMejorado: `Materializaci√≥n de actos de corrupci√≥n o conflictos de inter√©s en procesos institucionales cr√≠ticos que comprometen la integridad y transparencia`,
                    tipoRiesgo: 'Cumplimiento',
                    riesgoEtico: 'S√≠ - Actos contrarios a la probidad y √©tica p√∫blica',
                    causas: [
                        'Controles internos insuficientes o ineficaces',
                        'Falta de transparencia en procesos decisorios',
                        'Ausencia de declaraci√≥n de conflictos de inter√©s',
                        'Cultura organizacional d√©bil en √©tica e integridad'
                    ],
                    consecuencias: [
                        'P√©rdida de confianza ciudadana e institucional',
                        'Sanciones legales y administrativas severas',
                        'Da√±o irreparable a la imagen institucional',
                        'P√©rdidas econ√≥micas directas e indirectas',
                        'Intervenci√≥n de organismos externos'
                    ],
                    probabilidad: 2,
                    magnitud: 3,
                    controles: [
                        'Fortalecer el sistema de control interno',
                        'Implementar declaraci√≥n obligatoria de conflictos',
                        'Establecer canales seguros de denuncia',
                        'Crear programa de √©tica e integridad',
                        'Realizar auditor√≠as sorpresa regulares'
                    ],
                    recomendaciones: [
                        'Desarrollar c√≥digo de conducta espec√≠fico',
                        'Establecer comit√© de √©tica institucional',
                        'Implementar sistema de seguimiento continuo',
                        'Crear programa de incentivos por transparencia'
                    ]
                };
            }

            return analysis;
        }

        function displayAIResults(analysis) {
            const container = document.getElementById('aiResults');
            container.innerHTML = `
                <div style="text-align: left;">
                    <div style="margin-bottom: 1.5rem; padding: 1rem; background: var(--light-gray); border-radius: 8px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">üìù Evento Mejorado por IA</h4>
                        <p>${analysis.eventoMejorado}</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="padding: 1rem; background: var(--light-gray); border-radius: 8px;">
                            <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">üéØ Tipo de Riesgo</h4>
                            <p>${analysis.tipoRiesgo}</p>
                        </div>
                        <div style="padding: 1rem; background: var(--light-gray); border-radius: 8px;">
                            <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">‚öñÔ∏è Riesgo √âtico</h4>
                            <p>${analysis.riesgoEtico}</p>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem; padding: 1rem; background: var(--light-gray); border-radius: 8px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">‚ö†Ô∏è Causas Identificadas</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                            ${analysis.causas.map(causa => `<li style="margin-bottom: 0.25rem;">${causa}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem; padding: 1rem; background: var(--light-gray); border-radius: 8px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">üí• Consecuencias Potenciales</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                            ${analysis.consecuencias.map(cons => `<li style="margin-bottom: 0.25rem;">${cons}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="text-align: center; padding: 1rem; background: var(--light-gray); border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--primary-color);">${analysis.probabilidad}</div>
                            <div style="font-size: 0.8rem; color: var(--medium-gray);">PROBABILIDAD</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: var(--light-gray); border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--primary-color);">${analysis.magnitud}</div>
                            <div style="font-size: 0.8rem; color: var(--medium-gray);">IMPACTO</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: var(--light-gray); border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--accent-color);">${analysis.probabilidad * analysis.magnitud}</div>
                            <div style="font-size: 0.8rem; color: var(--medium-gray);">SCORE TOTAL</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem; padding: 1rem; background: var(--light-gray); border-radius: 8px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">üõ°Ô∏è Controles Sugeridos</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                            ${analysis.controles.map(control => `<li style="margin-bottom: 0.25rem;">${control}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem; padding: 1rem; background: var(--light-gray); border-radius: 8px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">üí° Recomendaciones Adicionales</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                            ${analysis.recomendaciones.map(rec => `<li style="margin-bottom: 0.25rem;">${rec}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <button onclick="exportAIAnalysis()" class="report-btn">
                            üìÑ Exportar An√°lisis Completo
                        </button>
                    </div>
                </div>
            `;
        }

        function exportAIAnalysis() {
            alert('üéØ Funcionalidad de exportaci√≥n implementada!\n\n‚úÖ El an√°lisis se exportar√≠a en formato PDF con todos los detalles generados por la IA.');
        }

        // INICIALIZACI√ìN DEL SISTEMA
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar datos
            filteredRisks = [...riskDatabase];
            
            // Cargar dashboard inicial
            updateDashboardStats();
            updateDashboardChart();
            
            // Configurar event listeners adicionales
            setupEventListeners();
            
            console.log('üöÄ Laboratorio de Riesgos CGR v2.3 inicializado exitosamente');
        });

        function setupEventListeners() {
            // Animaciones en elementos interactivos
            document.querySelectorAll('.stat-card').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-8px) scale(1.02)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });

            // Interactividad en gr√°ficos
            const charts = document.querySelectorAll('.chart-canvas');
            charts.forEach(chart => {
                chart.addEventListener('click', function() {
                    this.style.transform = 'scale(1.1)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 200);
                });
            });
        }

        // Estilos din√°micos para animaciones
        const style = document.createElement('style');
        style.textContent = `
            @keyframes loadingBar {
                0% { width: 0%; }
                50% { width: 70%; }
                100% { width: 100%; }
            }
            
            .pulse-animation {
                animation: pulse 2s infinite;
            }
            
            @keyframes pulse {
                0%, 100% { transform: scale(1); opacity: 1; }
                50% { transform: scale(1.05); opacity: 0.8; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratorio de Riesgos CGR v2.3</title>
    <style>
        :root {
            --primary-color: #394A9A;
            --secondary-color: #25336C;
            --accent-color: #EA7305;
            --success-color: #28a9e0;
            --warning-color: #f8ae40;
            --danger-color: #ef4444;
            --light-gray: #f8fafc;
            --medium-gray: #64748b;
            --dark-gray: #1e293b;
            --cgr-gray: #dbdbdd;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --gradient-accent: linear-gradient(135deg, var(--accent-color), #ff6b35);
            --shadow-light: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 8px 25px rgba(0, 0, 0, 0.15);
            --shadow-heavy: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Helvetica', sans-serif;
            line-height: 1.6;
            color: var(--dark-gray);
            background: var(--gradient-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
            min-height: 100vh;
        }

        /* HEADER MEJORADO */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-medium);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-accent);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .cgr-logo {
            width: 80px;
            height: 80px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: 'Century Gothic', sans-serif;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: var(--shadow-light);
        }

        .header-info h1 {
            font-family: 'Century Gothic', sans-serif;
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .header-info p {
            color: var(--medium-gray);
            font-size: 1rem;
        }

        .version-badge {
            background: var(--gradient-accent);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: var(--shadow-light);
        }

        /* NAVEGACI√ìN MEJORADA */
        .main-nav {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .nav-button {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 15px;
            font-family: 'Century Gothic', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary-color);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-light);
            min-width: 160px;
            position: relative;
            overflow: hidden;
        }

        .nav-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            transition: left 0.3s ease;
            z-index: -1;
        }

        .nav-button:hover::before,
        .nav-button.active::before {
            left: 0;
        }

        .nav-button:hover,
        .nav-button.active {
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        /* M√ìDULOS MEJORADOS */
        .module {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow-medium);
            animation: fadeIn 0.5s ease;
            position: relative;
        }

        .module.active {
            display: block;
        }

        .module-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--cgr-gray);
        }

        .module-header h2 {
            font-family: 'Century Gothic', sans-serif;
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        .module-icon {
            font-size: 2.5rem;
            animation: pulse 2s infinite;
        }

        /* DASHBOARD DE ESTAD√çSTICAS ANIMADO */
        .dashboard-container {
            display: grid;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: var(--shadow-light);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-color);
            transition: all 0.3s ease;
        }

        .stat-card.total::before { background: var(--gradient-primary); }
        .stat-card.alto::before { background: var(--gradient-accent); }
        .stat-card.medio::before { background: linear-gradient(135deg, var(--warning-color), #ffd93d); }
        .stat-card.bajo::before { background: linear-gradient(135deg, var(--success-color), #6bcf7f); }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-heavy);
        }

        .stat-card:hover::before {
            height: 8px;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            font-family: 'Century Gothic', sans-serif;
            margin-bottom: 0.5rem;
            background: var(--gradient-primary);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: countUp 1s ease-out;
        }

        .stat-number.alto {
            background: var(--gradient-accent);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            color: var(--medium-gray);
            font-size: 1rem;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .stat-trend {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            opacity: 0.7;
        }

        /* GR√ÅFICO DE DONA INTERACTIVO */
        .chart-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow-light);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .chart-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .chart-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .chart-title {
            font-family: 'Century Gothic', sans-serif;
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .chart-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 2rem;
            position: relative;
        }

        .chart-canvas {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .chart-canvas:hover {
            transform: scale(1.05);
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            background: var(--light-gray);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .legend-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            box-shadow: var(--shadow-light);
        }

        .legend-text {
            font-weight: 600;
            color: var(--dark-gray);
        }

        /* SISTEMA DE FILTROS AVANZADO */
        .filters-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow-light);
            margin-bottom: 2rem;
        }

        .filters-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .filters-title {
            font-family: 'Century Gothic', sans-serif;
            color: var(--primary-color);
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .clear-all-btn {
            background: var(--gradient-accent);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-all-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .filter-group {
            position: relative;
        }

        .filter-label {
            display: block;
            margin-bottom: 0.5rem;
            font-family: 'Century Gothic', sans-serif;
            font-weight: 600;
            color: var(--dark-gray);
            font-size: 0.9rem;
        }

        .filter-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--cgr-gray);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(57, 74, 154, 0.1);
            transform: translateY(-1px);
        }

        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .filter-badge {
            background: var(--gradient-primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            animation: slideIn 0.3s ease;
        }

        .filter-badge-remove {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 0.7rem;
            padding: 0.2rem;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .filter-badge-remove:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* MAPA DE CALOR DIN√ÅMICO */
        .heatmap-section {
            margin-bottom: 2rem;
        }

        .heatmap-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .heatmap-title {
            font-family: 'Century Gothic', sans-serif;
            color: var(--primary-color);
            font-size: 1.3rem;
        }

        .view-controls {
            display: flex;
            gap: 0.5rem;
        }

        .view-btn {
            background: white;
            border: 2px solid var(--cgr-gray);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--medium-gray);
        }

        .view-btn.active {
            background: var(--gradient-primary);
            color: white;
            border-color: var(--primary-color);
        }

        .risk-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .risk-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-light);
            transition: all 0.3s ease;
            position: relative;
            animation: slideUp 0.5s ease;
        }

        .risk-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-heavy);
        }

        .risk-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
        }

        .risk-card.alto::before {
            background: var(--gradient-accent);
        }

        .risk-card.medio::before {
            background: linear-gradient(90deg, var(--warning-color), #ffd93d);
        }

        .risk-card.bajo::before {
            background: linear-gradient(90deg, var(--success-color), #6bcf7f);
        }

        .risk-header {
            padding: 1.5rem 1.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }

        .risk-level {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            color: white;
            white-space: nowrap;
        }

        .risk-level.alto {
            background: var(--gradient-accent);
        }

        .risk-level.medio {
            background: linear-gradient(135deg, var(--warning-color), #ffd93d);
        }

        .risk-level.bajo {
            background: linear-gradient(135deg, var(--success-color), #6bcf7f);
        }

        .risk-score {
            background: var(--cgr-gray);
            padding: 0.5rem 0.75rem;
            border-radius: 12px;
            font-weight: bold;
            color: var(--dark-gray);
            font-size: 0.9rem;
        }

        .risk-content {
            padding: 0 1.5rem 1.5rem;
        }

        .risk-title {
            font-family: 'Century Gothic', sans-serif;
            color: var(--dark-gray);
            font-size: 1.1rem;
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .risk-details {
            display: grid;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .risk-detail {
            display: flex;
            gap: 0.75rem;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .risk-icon {
            color: var(--primary-color);
            font-size: 1rem;
            margin-top: 0.1rem;
            flex-shrink: 0;
        }

        .risk-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--cgr-gray);
        }

        .metric {
            text-align: center;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            font-family: 'Century Gothic', sans-serif;
        }

        .metric-label {
            font-size: 0.8rem;
            color: var(--medium-gray);
            text-transform: uppercase;
            font-weight: 600;
            margin-top: 0.25rem;
        }

        /* SECCI√ìN DE REPORTES */
        .reports-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow-light);
            text-align: center;
        }

        .reports-title {
            font-family: 'Century Gothic', sans-serif;
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .report-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            font-family: 'Century Gothic', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-light);
        }

        .report-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .report-btn.accent {
            background: var(--gradient-accent);
        }

        /* ANIMACIONES */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes countUp {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* RESPONSIVE DESIGN */
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .main-nav {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-button {
                width: 100%;
                max-width: 300px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .risk-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ESTADOS ESPECIALES */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .no-data {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--medium-gray);
        }

        .no-data-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER MEJORADO -->
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="cgr-logo">CGR</div>
                    <div class="header-info">
                        <h1>üî¨ Laboratorio de Riesgos</h1>
                        <p>Contralor√≠a General de la Rep√∫blica</p>
                    </div>
                </div>
                <div class="version-badge">Versi√≥n 2.3</div>
            </div>
        </header>

        <!-- NAVEGACI√ìN MEJORADA -->
        <nav class="main-nav">
            <button class="nav-button active" onclick="showModule('inicio')" data-module="inicio">
                üè† Dashboard Principal
            </button>
            <button class="nav-button" onclick="showModule('modulo1')" data-module="modulo1">
                üìö Gu√≠a Interactiva
            </button>
            <button class="nav-button" onclick="showModule('modulo2')" data-module="modulo2">
                üå°Ô∏è An√°lisis de Riesgos
            </button>
            <button class="nav-button" onclick="showModule('modulo3')" data-module="modulo3">
                üî® Constructor IA
            </button>
        </nav>

        <!-- M√ìDULO PRINCIPAL: DASHBOARD -->
        <div id="inicio" class="module active">
            <div class="module-header">
                <h2><span class="module-icon">üìä</span>Dashboard de Gesti√≥n de Riesgos</h2>
                <p>An√°lisis integral y monitoreo en tiempo real de la matriz de riesgos institucional</p>
            </div>

            <!-- DASHBOARD DE ESTAD√çSTICAS ANIMADO -->
            <div class="dashboard-container">
                <div class="stats-grid">
                    <div class="stat-card total">
                        <div class="stat-trend">üìà</div>
                        <div class="stat-number" id="dashTotalRisks">0</div>
                        <div class="stat-label">Total de Riesgos</div>
                    </div>
                    <div class="stat-card alto">
                        <div class="stat-trend">üî•</div>
                        <div class="stat-number alto" id="dashHighRisks">0</div>
                        <div class="stat-label">Riesgos Cr√≠ticos</div>
                    </div>
                    <div class="stat-card medio">
                        <div class="stat-trend">‚ö†Ô∏è</div>
                        <div class="stat-number" id="dashMediumRisks">0</div>
                        <div class="stat-label">Riesgos Moderados</div>
                    </div>
                    <div class="stat-card bajo">
                        <div class="stat-trend">‚úÖ</div>
                        <div class="stat-number" id="dashLowRisks">0</div>
                        <div class="stat-label">Riesgos Controlados</div>
                    </div>
                </div>

                <!-- GR√ÅFICO DE DONA INTERACTIVO -->
                <div class="chart-section">
                    <div class="chart-header">
                        <h3 class="chart-title">üìä Distribuci√≥n de Riesgos por Criticidad</h3>
                        <p>An√°lisis visual de la composici√≥n actual de riesgos</p>
                    </div>
                    <div class="chart-container">
                        <canvas id="dashChart" width="300" height="300" class="chart-canvas"></canvas>
                    </div>
                    <div class="chart-legend">
                        <div class="legend-item" data-type="alto">
                            <div class="legend-color" style="background: var(--gradient-accent);"></div>
                            <span class="legend-text">Cr√≠ticos</span>
                        </div>
                        <div class="legend-item" data-type="medio">
                            <div class="legend-color" style="background: var(--warning-color);"></div>
                            <span class="legend-text">Moderados</span>
                        </div>
                        <div class="legend-item" data-type="bajo">
                            <div class="legend-color" style="background: var(--success-color);"></div>
                            <span class="legend-text">Controlados</span>
                        </div>
                    </div>
                </div>

                <!-- M√âTRICAS ADICIONALES -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="dashDivisions">4</div>
                        <div class="stat-label">Divisiones Monitoreadas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="dashProcedures">28</div>
                        <div class="stat-label">Procedimientos Evaluados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="dashCoverage">95%</div>
                        <div class="stat-label">Cobertura Institucional</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="dashRiskScore">7.2</div>
                        <div class="stat-label">Score Promedio</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- M√ìDULO 1: GU√çA INTERACTIVA (Simplificada) -->
        <div id="modulo1" class="module">
            <div class="module-header">
                <h2><span class="module-icon">üìö</span>Gu√≠a Interactiva de Riesgos</h2>
                <p>Conceptos fundamentales y marco regulatorio MOSEVRI</p>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                <div style="background: white; padding: 2rem; border-radius: 16px; box-shadow: var(--shadow-light);">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">üéØ ¬øQu√© es un Riesgo?</h3>
                    <p>Probabilidad de que ocurran eventos que tendr√≠an consecuencias sobre el cumplimiento de objetivos institucionales.</p>
                </div>
                
                <div style="background: white; padding: 2rem; border-radius: 16px; box-shadow: var(--shadow-light);">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">üìã Marco MOSEVRI</h3>
                    <p>Sistema Espec√≠fico de Valoraci√≥n del Riesgo Institucional que abarca √°mbitos estrat√©gicos, t√°cticos y operativos.</p>
                </div>
                
                <div style="background: white; padding: 2rem; border-radius: 16px; box-shadow: var(--shadow-light);">
                    <h3 style="color: var(--primary-color);
